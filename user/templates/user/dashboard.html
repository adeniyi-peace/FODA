{% extends "base.html" %}
{% block title %}Dashboard{% endblock title %}

{% block content %}

<section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 grid gap-6 lg:grid-cols-3 grid-cols-1">

  <!-- Profile Card -->
  <div class="bg-white rounded-2xl shadow-md p-6 col-span-2">
    <div class="flex items-center gap-4 mb-6">
      <div class="bg-orange-100 p-3 rounded-full">
        <svg class="h-8 w-8 text-orange-600" fill="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
        </svg>
      </div>
      <h2 class="text-xl font-bold text-gray-700">Profile</h2>
    </div>

    <div class="grid max-md:grid-cols-2 md:grid-cols-3 gap-4 text-sm">
      <div><p class="text-gray-400">Full Name</p><p class="font-medium">{{ user.full_name }}</p></div>
      <div><p class="text-gray-400">Email</p><p class="font-medium">{{ user.email }}</p></div>
      <div><p class="text-gray-400">Phone</p><p class="font-medium">{{ user.phone.as_national }}</p></div>
      <div><p class="text-gray-400">Date of Birth</p><p class="font-medium">{{ user.DOB }}</p></div>
      <div><p class="text-gray-400">Date Joined</p><p class="font-medium">{{ user.date_joined }}</p></div>
      <div><p class="text-gray-400">Last Login</p><p class="font-medium">{{ user.last_login }}</p></div>
    </div>

    <div class="mt-6 text-right space-x-2">
      <a href="{% url 'edit_profile' %}" class="btn-primary py-2 px-4 rounded-lg">Edit</a>
      <a href="{% url 'change_password' %}" class="btn-secondary">Change Password</a>
      <a href="{% url 'delete_profile' %}" class="btn-danger">Delete</a>
    </div>
  </div>

  <!-- Cart Card -->
  <div class="bg-white rounded-2xl shadow-md p-6">
    <div class="flex items-center gap-4 mb-6">
      <div class="bg-orange-100 p-3 rounded-full">
        <svg class="h-8 w-8 text-orange-600" fill="currentColor" viewBox="0 0 24 24"><path d="M7 4h-2l-1 2h16l-1-2h-2l-3 6h-4l-3-6zM7 10h10v8h-10z"/></svg>
      </div>
      <h2 class="text-xl font-bold text-gray-700">Cart</h2>
    </div>

    {% if cart %}
      <div class="space-y-4">
        {% for item in cart %}
          <div class="flex items-center gap-4">
            <img src="{{ item.food.image.url }}" class="w-16 h-16 rounded object-cover" alt="{{ item.food.name }}">
            <div>
              <p class="font-medium">{{ item.food.name }}</p>
              <p class="text-gray-500 text-sm">{{ item.price }}</p>
            </div>
          </div>
        {% endfor %}
      </div>
      <div class="mt-4 text-right">
        <a href="{% url 'cart_summary' %}" class="btn-primary py-2 px-4">Complete Order</a>
      </div>
    {% else %}
      <div class="text-center text-orange-600 border border-orange-300 p-4 rounded-md">
        <p>No items in cart</p>
        <a href="{% url 'index' %}" class="btn-primary  py-2 px-4 rounded-lg mt-2 inline-block">Shop Now</a>
      </div>
    {% endif %}
  </div>

</section>

<!-- Order History & Address -->
<section class="max-w-7xl mx-auto px-4 py-8 grid lg:grid-cols-2 gap-6 grid-cols-1">
  <!-- Orders -->
  <div class="bg-white rounded-2xl shadow-md p-6">
    <div class="flex items-center gap-4 mb-4">
    <svg class="h-8 w-8 text-orange-600" viewBox="0 0 24 24" fill="currentColor">
      <path d="M3 3h18v2H3V3zm3 4h12v2H6V7zm-3 4h18v2H3v-2zm3 4h12v2H6v-2zm-3 4h18v2H3v-2z"/>
    </svg>
    <h2 class="text-xl font-bold text-gray-700">Order History</h2>
  </div>

    {% if orders %}
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left">
          <thead>
            <tr class="text-gray-500 border-b">
              <th>Order number</th><th>Price</th><th>Date</th><th>Qty</th><th>Status</th><th></th>
            </tr>
          </thead>
          <tbody>
            {% for order in orders %}
            <tr class="border-b">
              <td class="py-2 flex items-center gap-3">
                <!-- <img src="{{ order.food.image.url }}" class="w-10 h-10 object-cover rounded" alt=""> -->
                #{{ order.id }}
              </td>
              <td class="text-orange-600">â‚¦{{ order.get_total_price }}</td>
              <td>{{ order.order_date }}</td>
              <td>{{ order.get_total_quantity }}</td>
              <td>
                <span class="inline-block px-2 py-1 rounded text-white text-xs font-medium {% if order.get_status_display == 'Pending' %}bg-burntOrange-700{% elif order.get_status_display == 'Confirmed' %}bg-green-600{% elif order.get_status_display == 'Canceled' %}bg-red-500{% else %}bg-gray-500{% endif %}">
                  {{ order.get_status_display }}
                </span>
              </td>
              <td><a href="{% url "order_detail" order.id %}" class="text-blue-600 text-sm">
                <svg class="fill-burntOrange-700 hover:fill-burntOrange-600 active:fill-burntOrange-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" class="inline-block align-middle">
                  <path d="M12 4.5C7 4.5 2.73 8.11 1 12c1.73 3.89 6 7.5 11 7.5s9.27-3.61 11-7.5c-1.73-3.89-6-7.5-11-7.5zm0 
                        13c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8a3 3 0 100 6 3 3 0 000-6z"/>
                </svg>
              </a></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="text-right mt-3">
        <a href="{% url 'orders' %}" class="text-sm text-orange-700">See All</a>
      </div>
    {% else %}
      <p class="text-center text-orange-600">No order history yet. <a href="{% url 'index' %}" class="underline">Shop now</a>.</p>
    {% endif %}
  </div>

  <!-- Addresses -->
  <div class="bg-white rounded-2xl shadow-md p-6">
    <div class="flex items-center gap-4 mb-4">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#CC5500" width="32" height="32" class="svg-icon">
            <path d="M12 2C8.13401 2 5 5.13401 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86599-3.134-7-7-7zm0 9.5c-1.3807 
            0-2.5-1.1193-2.5-2.5s1.1193-2.5 2.5-2.5 2.5 1.1193 2.5 2.5-1.1193 2.5-2.5 2.5z"/>
        </svg>
        <h2 class="text-xl font-bold text-gray-700">Delivery Information</h2>
    </div>

    {% if addresses %}
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="text-gray-500 border-b"><th>Name</th><th>Street</th><th>City</th><th>State</th><th>Phone</th></tr>
          </thead>
          <tbody>
            {% for addr in addresses %}
              <tr class="border-b"><td>{{ addr.full_name }}</td><td>{{ addr.street }}</td><td>{{ addr.city }}</td><td>{{ addr.state }}</td><td>{{ addr.phone.as_national }}</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="text-right mt-3">
        <a href="{% url 'address_list' %}" class="text-sm text-orange-700">See All</a>
      </div>
    {% else %}
      <p class="text-center text-orange-600">No address yet. <a href="{% url 'add_address' %}" class="underline">Add one</a>.</p>
    {% endif %}
  </div>
</section>

{% endblock content %}
